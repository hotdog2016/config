"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const coc_nvim_1 = require("coc.nvim");
async function activate(context) {
    const config = coc_nvim_1.workspace.getConfiguration().get('sourcekit', {});
    if (config.enable === false) {
        return;
    }
    let commandPath = config.commandPath;
    if (!commandPath) {
        try {
            commandPath = (await coc_nvim_1.workspace.runCommand('xcrun --toolchain swift --find sourcekit-lsp')).trim();
        }
        catch (_a) {
            coc_nvim_1.workspace.showMessage("Cannot find sourcekit-lsp. Install a Swift toolchain or set `sourcekit.commandPath` in your coc-config.");
            return;
        }
    }
    const serverOptions = {
        command: commandPath,
        transport: coc_nvim_1.TransportKind.stdio
    };
    const clientOptions = {
        documentSelector: ['swift']
    };
    const client = new coc_nvim_1.LanguageClient('sourcekit', 'sourcekit', serverOptions, clientOptions);
    context.subscriptions.push(coc_nvim_1.services.registLanguageClient(client));
}
exports.activate = activate;
//# sourceMappingURL=extension.js.map